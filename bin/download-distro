#!/bin/bash

# Exit on failure
set -e

# ARGS

VERSION="${1}"

# CONSTANTS

FILENAME="${VERSION}-server-cloudimg-amd64"
URL="https://cloud-images.ubuntu.com/${VERSION}/current/${FILENAME}.img"
DIR="/srv/artifacts"

# VALIDATE

if [ "${VERSION}" = "" ]; then
  echo "❗  Invalid VERSION: ${VERSION}" >&2
  exit 1
fi

# START

curl -O --output-dir "${DIR}" "${URL}"
qemu-img convert -O qcow2 "${DIR}/${FILENAME}.img" "${DIR}/${FILENAME}.qcow2"
