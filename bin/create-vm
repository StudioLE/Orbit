#!/bin/bash
set -euo pipefail

# IMPORTS

source /srv/lib/boot-disk/create-boot-disk.sh

# ARGS

OS_NAME="ubuntu"
OS_VERSION="jammy"
DISK_SIZE="20G"

TYPE="c1"
MEMORY="8"
CORES="4"
PURPOSE="worker"
NAME="${PURPOSE}-${TYPE}"
TAGS="${PURPOSE},${TYPE},${OS_NAME},${OS_NAME}-${OS_VERSION}"

# START

create-boot-disk "${OS_NAME}" "${OS_VERSION}" "${DISK_SIZE}"
DISK_FILE="${OUTPUT}"

/srv/lib/vm/create-vm.sh \
  --memory "${MEMORY}" \
  --cores "${CORES}" \
  --disk-file "${DISK_FILE}" \
  --name "${NAME}" \
  --tags "${TAGS}"
